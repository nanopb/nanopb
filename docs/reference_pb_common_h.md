# pb_common.h

## Message descriptor handling

### pb_field_iter_begin

Begins iterating over the fields in a message type:

    bool pb_field_iter_begin(pb_field_iter_t *iter, const pb_msgdesc_t *desc, void *message);

|                      |                                                        |
|----------------------|--------------------------------------------------------|
| iter                 | Pointer to destination [pb_field_iter_t](#pb_field_iter_t) variable.
| desc                 | Autogenerated message descriptor.
| message              | Pointer to message structure.
| returns              | True on success, false if the message type has no fields.

### pb_field_iter_next

Advance to the next field in the message:

    bool pb_field_iter_next(pb_field_iter_t *iter);

|                      |                                                        |
|----------------------|--------------------------------------------------------|
| iter                 | Pointer to `pb_field_iter_t` previously initialized by [pb_field_iter_begin](#pb_field_iter_begin).
| returns              | True on success, false after last field in the message.

When the last field in the message has been processed, this function
will return false and initialize `iter` back to the first field in the
message.

### pb_field_iter_find

Find a field specified by tag number in the message:

    bool pb_field_iter_find(pb_field_iter_t *iter, uint32_t tag);

|                      |                                                        |
|----------------------|--------------------------------------------------------|
| iter                 | Pointer to `pb_field_iter_t` previously initialized by [pb_field_iter_begin](#pb_field_iter_begin).
| tag                  | Tag number to search for.
| returns              | True if field was found, false otherwise.

This function is functionally identical to calling `pb_field_iter_next()` until `iter.tag` equals the searched value.
Internally this function avoids fully processing the descriptor for intermediate fields.

## Other utility functions

### pb_validate_utf8

Validates an UTF8 encoded string:

    bool pb_validate_utf8(const char *s);

|                      |                                                        |
|----------------------|--------------------------------------------------------|
| s                    | Pointer to beginning of a string.
| returns              | True, if string is valid UTF-8, false otherwise.

The protobuf standard requires that `string` fields only contain valid
UTF-8 encoded text, while `bytes` fields can contain arbitrary data.
When the compilation option `PB_VALIDATE_UTF8` is defined, nanopb will
automatically validate strings on both encoding and decoding.

User code can call this function to validate strings in e.g. custom
callbacks.
